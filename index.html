<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Letter for You</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f1e8 0%, #e8dcc8 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: background 1s ease;
        }

        /* PHASE 1 - ENTRY SCREEN */
        #entryScreen {
            text-align: center;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        #entryScreen.hidden {
            opacity: 0;
            pointer-events: none;
            position: absolute;
        }

        .entry-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 60px 40px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .entry-message {
            font-size: 24px;
            color: #4a4a4a;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 300;
        }

        .heart-button {
            width: 80px;
            height: 80px;
            background: #fff;
            border: 2px solid #d4a5a5;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .heart-button:hover {
            transform: scale(1.1);
            background: #fff5f5;
            border-color: #c48888;
        }

        .heart-icon {
            font-size: 36px;
            color: #d4a5a5;
        }

        .entry-instruction {
            font-size: 16px;
            color: #777;
            margin-top: 15px;
        }

        .qr-container {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
        }

        .qr-code {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* PHASE 2 - LETTER SCREEN */
        #letterScreen {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            width: 100%;
            max-width: 800px;
        }

        #letterScreen.visible {
            opacity: 1;
            pointer-events: all;
        }

        .paper {
            background: #fefdfb;
            padding: 60px 50px;
            border-radius: 2px;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.12),
                0 10px 30px rgba(0, 0, 0, 0.15),
                inset 0 0 100px rgba(139, 121, 94, 0.03);
            position: relative;
            transform: rotate(-0.5deg);
            transition: all 0.5s ease;
            line-height: 2;
            min-height: 600px;
        }

        .paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 31px,
                    rgba(139, 121, 94, 0.04) 31px,
                    rgba(139, 121, 94, 0.04) 32px
                );
            pointer-events: none;
            border-radius: 2px;
        }

        .timestamp {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 14px;
            color: #999;
            font-family: 'Courier New', monospace;
        }

        .letter-content {
            font-family: 'Segoe Script', 'Bradley Hand', cursive;
            font-size: 18px;
            color: #2c2416;
            position: relative;
            z-index: 1;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 22px;
            background: #2c2416;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .thinking {
            color: #999;
            font-style: italic;
            font-size: 16px;
        }

        .signature {
            margin-top: 40px;
            text-align: right;
            font-size: 20px;
        }

        .final-message {
            text-align: center;
            margin-top: 50px;
            font-size: 16px;
            color: #888;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .final-message.visible {
            opacity: 1;
        }

        /* Hug Animation */
        .hug-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0);
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 1s ease, background 1s ease;
        }

        .hug-container.visible {
            opacity: 1;
            background: rgba(0, 0, 0, 0.7);
        }

        .hug-scene {
            position: relative;
            width: 300px;
            height: 300px;
        }

        .person {
            position: absolute;
            width: 80px;
            height: 140px;
            transition: all 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .person-left {
            left: 50px;
            transform: translateX(-150px) scale(0.8);
            opacity: 0;
        }

        .person-right {
            right: 50px;
            transform: translateX(150px) scale(0.8);
            opacity: 0;
        }

        .hug-container.visible .person-left {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .hug-container.visible .person-right {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .head {
            width: 40px;
            height: 40px;
            background: #f4c2a5;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
            animation: breatheHead 2s ease-in-out infinite;
        }

        @keyframes breatheHead {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .body {
            width: 50px;
            height: 70px;
            background: #d4a5a5;
            margin: 5px auto;
            border-radius: 25px 25px 0 0;
            position: relative;
        }

        .person-right .body {
            background: #a5b8d4;
        }

        .arm {
            position: absolute;
            width: 15px;
            height: 50px;
            background: #d4a5a5;
            border-radius: 10px;
            top: 10px;
        }

        .person-right .arm {
            background: #a5b8d4;
        }

        .arm-left {
            left: -10px;
            transform-origin: top center;
            animation: hugArmLeft 1.5s ease-in-out 1.5s forwards;
        }

        .arm-right {
            right: -10px;
            transform-origin: top center;
            animation: hugArmRight 1.5s ease-in-out 1.5s forwards;
        }

        @keyframes hugArmLeft {
            0% { transform: rotate(20deg); }
            100% { transform: rotate(110deg); }
        }

        @keyframes hugArmRight {
            0% { transform: rotate(-20deg); }
            100% { transform: rotate(-110deg); }
        }

        .heart-float {
            position: absolute;
            font-size: 24px;
            opacity: 0;
            animation: floatHeart 3s ease-out forwards;
        }

        @keyframes floatHeart {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }
            20% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1.2);
            }
        }

        .hug-text {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 24px;
            font-family: 'Segoe Script', cursive;
            opacity: 0;
            animation: fadeInText 1s ease-in 3s forwards;
        }

        @keyframes fadeInText {
            to { opacity: 1; }
        }

        /* Audio toggle */
        .audio-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .audio-toggle:hover {
            background: rgba(255, 255, 255, 1);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .entry-card {
                padding: 40px 30px;
            }

            .entry-message {
                font-size: 20px;
            }

            .paper {
                padding: 40px 30px;
                transform: rotate(0deg);
            }

            .letter-content {
                font-size: 16px;
                line-height: 1.8;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Toggle -->
    <button class="audio-toggle" id="audioToggle">ðŸ”‡ Sound Off</button>

    <!-- PHASE 1: Entry Screen -->
    <div id="entryScreen">
        <div class="entry-card">
            <p class="entry-message">Before you read thisâ€¦<br>I just need one moment of your attention.</p>
            
            <div class="heart-button" id="heartButton">
                <span class="heart-icon">â™¥</span>
            </div>
            
            <p class="entry-instruction">Tap the heart to begin</p>
            
            <div class="qr-container">
                <p style="color: #999; font-size: 14px; margin-bottom: 10px;">or scan this</p>
                <div class="qr-code">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100" height="100" fill="white"/>
                        <g fill="black">
                            <rect x="10" y="10" width="25" height="25"/>
                            <rect x="65" y="10" width="25" height="25"/>
                            <rect x="10" y="65" width="25" height="25"/>
                            <rect x="15" y="15" width="15" height="15" fill="white"/>
                            <rect x="70" y="15" width="15" height="15" fill="white"/>
                            <rect x="15" y="70" width="15" height="15" fill="white"/>
                            <rect x="45" y="15" width="5" height="5"/>
                            <rect x="55" y="15" width="5" height="5"/>
                            <rect x="45" y="25" width="5" height="5"/>
                            <rect x="50" y="30" width="10" height="5"/>
                            <rect x="40" y="40" width="20" height="5"/>
                            <rect x="45" y="50" width="15" height="5"/>
                            <rect x="70" y="45" width="10" height="5"/>
                            <rect x="65" y="55" width="15" height="5"/>
                            <rect x="45" y="65" width="10" height="10"/>
                            <rect x="60" y="70" width="5" height="10"/>
                            <rect x="70" y="80" width="15" height="5"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- PHASE 2: Letter Screen -->
    <div id="letterScreen">
        <div class="paper">
            <div class="timestamp" id="timestamp"></div>
            <div class="letter-content" id="letterContent"></div>
            <div class="final-message" id="finalMessage">I miss you.</div>
        </div>
    </div>

    <!-- Hug Animation -->
    <div class="hug-container" id="hugContainer">
        <div class="hug-scene">
            <div class="person person-left">
                <div class="head"></div>
                <div class="body">
                    <div class="arm arm-left"></div>
                    <div class="arm arm-right"></div>
                </div>
            </div>
            <div class="person person-right">
                <div class="head"></div>
                <div class="body">
                    <div class="arm arm-left"></div>
                    <div class="arm arm-right"></div>
                </div>
            </div>
        </div>
        <div class="hug-text">I miss you...</div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION - CUSTOMIZE YOUR LETTER HERE
        // ==========================================
        const LETTER_SECTIONS = [
            {
                text: "Heyâ€¦\n\n",
                pauseAfter: 2000
            },
            {
                text: "Ik I messed up a lot. ",
                pauseAfter: 1800
            },
            {
                text: "Agar aaj mil paate to letter tujhe likh ke dene wala tha but nai mil paye toâ€¦ ",
                pauseAfter: 1500
            },
            {
                text: "I am coding this, a letter for you.\n\n",
                pauseAfter: 2500
            },
            {
                thinking: "thinkingâ€¦",
                duration: 3000
            },
            {
                text: "I miss you a lot. ",
                pauseAfter: 1500
            },
            {
                text: "I am sorry for what I did kal. The way I spoke kalâ€¦ ",
                pauseAfter: 1800
            },
            {
                text: "ik you don't deserve that. ",
                pauseAfter: 1500
            },
            {
                text: "I am really really really sorry for that, dil se",
                pauseAfter: 1000
            },
            {
                text: ".\n\n",
                pauseAfter: 2000
            },
            {
                text: "I can't even stop crying. Mere aankhe laal ho gayi hai just thinking",
                backspace: 8,
                rewrite: "thinking about it",
                pauseAfter: 2000
            },
            {
                text: ". And it's not overthinking please, I just think for you, for you. ",
                pauseAfter: 2000
            },
            {
                text: "Itna to maine mere parents ka bhi nai socha, I swear.\n\n",
                pauseAfter: 2500
            },
            {
                thinking: "...",
                duration: 3000
            },
            {
                text: "All that was for time and attention. Uski wajah se itna sab badh gaya. ",
                pauseAfter: 2000
            },
            {
                text: "I am sorry, really sorry for that. ",
                pauseAfter: 1500
            },
            {
                text: "I don't know what to say but I didn't mean that at all. ",
                pauseAfter: 1800
            },
            {
                text: "Mujhe ye sab bolna nai tha.\n\n",
                pauseAfter: 2000
            },
            {
                text: "But please understandâ€¦ I can't live without you. ",
                pauseAfter: 2500
            },
            {
                text: "I am sorry, so much sorry. ",
                pauseAfter: 1500
            },
            {
                text: "I am just making this to make you feel happy. ",
                pauseAfter: 2000
            },
            {
                text: "I am not happy but it's my duty to make you happy because everything is because of me.\n\n",
                pauseAfter: 2500
            },
            {
                thinking: "thinkingâ€¦",
                duration: 3500
            },
            {
                text: "Please forgive me, please. ",
                pauseAfter: 1800
            },
            {
                text: "I never wanted you to cry and it's not at all easy for me to forget your crying face. ",
                pauseAfter: 2500
            },
            {
                text: "I am sorry.\n\n",
                pauseAfter: 2000
            },
            {
                text: "I am a bit over in everythingâ€¦ I am over expressive, over sensitive, over thinker and everything over. ",
                pauseAfter: 2000
            },
            {
                text: "But this is only for 1 person and not for anyone else, not even for my parents. ",
                pauseAfter: 2000
            },
            {
                text: "So please think how much you are for me, how muchâ€¦\n\n",
                pauseAfter: 2500
            },
            {
                text: "Baki kisi ke liye itna na karu. ",
                pauseAfter: 1500
            },
            {
                text: "Kal raat se rote rote I am making this for you. ",
                pauseAfter: 2000
            },
            {
                text: "Ye jatane ke liye nai bata raha, isliye bata raha hu to make you feel how much you are for me.\n\n",
                pauseAfter: 3000
            },
            {
                thinking: "...",
                duration: 3000
            },
            {
                text: "Aahâ€¦ I am sorry. Pls maaf kar de pls. ",
                pauseAfter: 2000
            },
            {
                text: "You be happy after this and enjoy your day. ",
                pauseAfter: 1800
            },
            {
                text: "I will be happy on my own, I swear. ",
                pauseAfter: 1500
            },
            {
                text: "You are the best. ",
                pauseAfter: 1500
            },
            {
                text: "Pls don't take me wrong in any way, this is pure dil se ekdam. ",
                pauseAfter: 2000
            },
            {
                text: "Pls plssâ€¦\n\n",
                pauseAfter: 2500
            },
            {
                text: "I am sorry. ",
                pauseAfter: 2000
            },
            {
                thinking: "...",
                duration: 2500
            },
            {
                text: "I miss you...\n\n",
                pauseAfter: 3000,
                showHug: true
            },
            {
                signature: true,
                text: "â€” Aarya",
                pauseAfter: 2000
            }
        ];

        // ==========================================
        // AUDIO SYSTEM
        // ==========================================
        let audioEnabled = false;
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playTypingSound() {
            if (!audioEnabled) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800 + Math.random() * 200;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
        }

        function playPaperSound() {
            if (!audioEnabled) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 100;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.03, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        document.getElementById('audioToggle').addEventListener('click', function() {
            audioEnabled = !audioEnabled;
            this.textContent = audioEnabled ? 'ðŸ”Š Sound On' : 'ðŸ”‡ Sound Off';
        });

        // ==========================================
        // PHASE 1: ENTRY LOGIC
        // ==========================================
        const entryScreen = document.getElementById('entryScreen');
        const letterScreen = document.getElementById('letterScreen');
        const heartButton = document.getElementById('heartButton');

        function checkURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('start') === 'true') {
                beginLetter();
            }
        }

        function beginLetter() {
            playPaperSound();
            entryScreen.classList.add('hidden');
            
            setTimeout(() => {
                letterScreen.classList.add('visible');
                setTimestamp();
                setTimeout(() => {
                    startTyping();
                }, 500);
            }, 800);
        }

        heartButton.addEventListener('click', beginLetter);
        checkURLParams();

        // ==========================================
        // PHASE 2: LETTER TYPING LOGIC
        // ==========================================
        const letterContent = document.getElementById('letterContent');
        const finalMessage = document.getElementById('finalMessage');
        let currentText = '';
        let sectionIndex = 0;
        let charIndex = 0;
        let isTyping = false;

        function setTimestamp() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'AM' : 'PM';
            const displayHours = hours % 12 || 12;
            document.getElementById('timestamp').textContent = `${displayHours}:${minutes} ${ampm}`;
        }

        function getTypingSpeed() {
            // Vary typing speed naturally between 50-150ms
            return 50 + Math.random() * 100;
        }

        function typeCharacter(char) {
            currentText += char;
            letterContent.innerHTML = currentText + '<span class="cursor"></span>';
            playTypingSound();
        }

        function deleteCharacter() {
            currentText = currentText.slice(0, -1);
            letterContent.innerHTML = currentText + '<span class="cursor"></span>';
            playTypingSound();
        }

        async function processSection(section) {
            // Handle thinking pause
            if (section.thinking) {
                const thinkingText = `<span class="thinking">${section.thinking}</span>`;
                letterContent.innerHTML = currentText + thinkingText + '<span class="cursor"></span>';
                await sleep(section.duration);
                letterContent.innerHTML = currentText + '<span class="cursor"></span>';
                return;
            }

            // Handle signature
            if (section.signature) {
                currentText += '\n';
                letterContent.innerHTML = currentText + '<span class="cursor"></span>';
                await sleep(500);
            }

            // Type the text character by character
            const text = section.text;
            for (let i = 0; i < text.length; i++) {
                typeCharacter(text[i]);
                await sleep(getTypingSpeed());
            }

            // Handle backspace and rewrite
            if (section.backspace && section.rewrite) {
                await sleep(800);
                for (let i = 0; i < section.backspace; i++) {
                    deleteCharacter();
                    await sleep(80);
                }
                await sleep(300);
                for (let char of section.rewrite) {
                    typeCharacter(char);
                    await sleep(getTypingSpeed());
                }
            }

            // Show hug animation if specified
            if (section.showHug) {
                await sleep(1000);
                showHugAnimation();
            }

            // Pause after section
            if (section.pauseAfter) {
                await sleep(section.pauseAfter);
            }
        }

        async function startTyping() {
            for (const section of LETTER_SECTIONS) {
                await processSection(section);
            }

            // Finish - remove cursor and show final message
            await sleep(1000);
            letterContent.innerHTML = currentText;
            await sleep(2000);
            finalMessage.classList.add('visible');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ==========================================
        // HUG ANIMATION
        // ==========================================
        const hugContainer = document.getElementById('hugContainer');

        function showHugAnimation() {
            hugContainer.classList.add('visible');
            
            // Create floating hearts
            setTimeout(() => {
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        createFloatingHeart();
                    }, i * 400);
                }
            }, 2000);

            // Hide hug animation after it plays
            setTimeout(() => {
                hugContainer.classList.remove('visible');
            }, 8000);
        }

        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart-float';
            heart.textContent = 'â™¥';
            heart.style.left = (40 + Math.random() * 20) + '%';
            heart.style.top = '50%';
            heart.style.animationDelay = '0s';
            heart.style.color = `hsl(${Math.random() * 60 + 330}, 70%, 70%)`;
            
            hugContainer.querySelector('.hug-scene').appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 3000);
        }
    </script>
</body>
</html>
